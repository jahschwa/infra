---
- name: Install xonsh
  pip:
    name:
      - xonsh[full]

- name: Get python version
  command:
    cmd: python3 --version
  register: raw_python_version
  changed_when: False

- name: Parse python version
  set_fact:
    python_version: '{{ raw_python_version.stdout | regex_search("[0-9.]+$") }}'

- name: Generate .xonshrc
  template:
   src: xonshrc.j2
   dest: '~/.xonshrc'
   lstrip_blocks: True
  become: False

- name: Find xonsh path
  command:
    cmd: which xonsh
  register: xonsh_path
  changed_when: False

- name: Add xonsh to shells
  lineinfile:
    path: /etc/shells
    regexp: '{{ xonsh_path.stdout }}'
    line: '{{ xonsh_path.stdout }}'

- name: Set shell to xonsh
  command:
    cmd: 'chsh -s {{ xonsh_path.stdout }} {{ user }}'
